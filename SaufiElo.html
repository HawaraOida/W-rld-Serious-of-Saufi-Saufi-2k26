<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>W√∂rld Serious of Saufi Saufi</title>
    
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Supabase Bibliothek -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    
    <!-- 3. Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- 4. Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçª</text></svg>">

    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        .fade-in { animation: fadeIn 0.2s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        canvas { max-width: 100% !important; }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 pb-20">

    <!-- Header -->
    <div class="bg-emerald-700 text-white p-4 shadow-md sticky top-0 z-50">
        <div class="max-w-3xl mx-auto flex items-start justify-between gap-2">
            <div class="flex items-start gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-yellow-400 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <circle cx="5.5" cy="8" r="3.5" />
                    <circle cx="12" cy="8" r="3.5" />
                    <circle cx="18.5" cy="8" r="3.5" />
                    <circle cx="8.75" cy="13" r="3.5" />
                    <circle cx="15.25" cy="13" r="3.5" />
                </svg>
                <div>
                    <h1 class="text-lg font-bold leading-tight">W√∂rld Serious of Saufi Saufi - VuiBlattlympics 2k26</h1>
                    <p class="text-[10px] text-emerald-100 leading-snug mt-1 max-w-md opacity-90 tracking-wider font-bold">
                        W√∂rld Serious of Saufi Saufi - VuiBlattlympics 2k26 is des official Megaevent f√ºr olle, de liaba vui blattln statt trainiern. K√§mpft werd net nur um Elo, sondern um'n heiligen Waundapokal zum Ausasaufn.
                    </p>
                </div>
            </div>
            
            <button onclick="app.exportCSV()" class="text-xs bg-emerald-800 hover:bg-emerald-900 px-3 py-2 rounded border border-emerald-600 transition flex flex-col items-center gap-1 shrink-0">
                <span class="text-lg">üì•</span> 
                <span class="hidden sm:inline">Excel</span>
            </button>
        </div>
    </div>

    <!-- Navigation -->
    <div class="max-w-4xl mx-auto mt-4 px-2">
        <div class="flex bg-white rounded-lg shadow p-1 mb-6 overflow-x-auto no-scrollbar">
            <button onclick="app.setTab('rank')" id="btn-rank" class="flex-1 min-w-[80px] py-2 rounded text-xs sm:text-sm font-medium transition">Rangliste</button>
            <button onclick="app.setTab('history')" id="btn-history" class="flex-1 min-w-[80px] py-2 rounded text-xs sm:text-sm font-medium transition">Matches</button>
            <button onclick="app.setTab('match')" id="btn-match" class="flex-1 min-w-[80px] py-2 rounded text-xs sm:text-sm font-medium transition">Match +</button>
            <button onclick="app.setTab('settings')" id="btn-settings" class="flex-1 min-w-[80px] py-2 rounded text-xs sm:text-sm font-medium transition">Spieler</button>
        </div>

        <!-- Content Container -->
        <div id="app-content" class="fade-in max-w-3xl mx-auto">
            <div class="text-center mt-10 text-slate-500 flex flex-col items-center">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-700 mb-2"></div>
                <p>Lade Daten...</p>
            </div>
        </div>
    </div>

    <script>
        const K_FACTOR = 32;
        const SUPABASE_URL = 'https://tbeupewhdgcyxugxsfjd.supabase.co'; 
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRiZXVwZXdoZGdjeXh1Z3hzZmpkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM3NDY4NzIsImV4cCI6MjA3OTMyMjg3Mn0.hqICv1Yy4spdJa6sKZSnDXQL2r0sCHlBg3CL1DE10BU';
        
        let sbClient = null;

        try {
            sbClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        } catch (e) {
            console.error("Supabase Init Fehler:", e);
        }

        const app = {
            data: {
                players: [],
                history: [],
                activeTab: 'rank',
                matchInputs: Array(8).fill(''),
                winnerMode: 0,
                footerImageUrl: 'https://i.imgur.com/gbT3wOm.jpeg' 
            },

            init() {
                if (!sbClient) return;
                this.fetchData()
                    .then(() => this.render())
                    .catch((err) => this.renderError(err));
            },

            async fetchData() {
                try {
                    let { data: players, error: playersError } = await sbClient
                        .from('players')
                        .select('*')
                        .order('elo', { ascending: false });

                    if (playersError) throw playersError;

                    let { data: history, error: historyError } = await sbClient
                        .from('history')
                        .select('*')
                        .order('match_id', { ascending: true });
                    
                    if (historyError) throw historyError;

                    this.data.players = players || [];
                    this.data.history = (history || []).map(entry => ({
                        ...entry,
                        ranking: entry.ranking ? entry.ranking.split(',').map(s => s.trim()) : []
                    }));

                    if (this.data.players.length === 0) {
                        this.data.players = Array.from({length: 8}, (_, i) => ({
                            id: 'p' + (i+1),
                            name: 'Saufi ' + (i+1),
                            elo: 1000,
                            matches: 0,
                            wins: 0
                        }));
                        await sbClient.from('players').insert(this.data.players);
                    }
                } catch (error) {
                    console.error("Ladefehler:", error);
                    throw error;
                }
            },

            async saveData(newHistoryEntry) {
                try {
                    for(const p of this.data.players) {
                        await sbClient.from('players').update(p).eq('id', p.id);
                    }

                    if (newHistoryEntry) {
                        const nextId = this.data.history.length + 1;
                        const { error: insertHistoryError } = await sbClient
                            .from('history')
                            .insert([{
                                match_id: nextId,
                                date: newHistoryEntry.date,
                                mode: newHistoryEntry.mode,
                                ranking: newHistoryEntry.ranking.join(', '),
                                match_name: newHistoryEntry.match_name || ''
                            }]);
                        if (insertHistoryError) throw insertHistoryError;
                    }
                } catch (error) {
                    console.error("Speicherfehler:", error);
                    throw error;
                }
            },

            setTab(tab) {
                this.data.activeTab = tab;
                this.render();
            },

            setWinnerMode(mode) {
                this.data.winnerMode = mode;
                this.render();
            },

            updateMatchInput(index, value) {
                this.data.matchInputs[index] = value;
                this.render(); // Sofort neu rendern um Validierung anzuzeigen
            },

            updatePlayerName(id, newName) {
                const p = this.data.players.find(pl => pl.id === id);
                if(p) {
                    p.name = newName;
                    sbClient.from('players').update({name: newName}).eq('id', id);
                }
            },

            getExpectation(ra, rb) {
                return 1 / (1 + Math.pow(10, (rb - ra) / 400));
            },

            async submitMatch() {
                const matchName = document.getElementById('input-match-name')?.value.trim() || '';
                const activeIds = this.data.matchInputs.filter(id => id !== "");

                if (activeIds.length < 2) return alert("Mindestens 2 Spieler n√∂tig!");
                if (new Set(activeIds).size !== activeIds.length) return alert("Spieler d√ºrfen nicht doppelt ausgew√§hlt werden!");

                const eloDeltas = {};
                activeIds.forEach(id => eloDeltas[id] = 0);
                const playersMap = new Map(this.data.players.map(p => [p.id, {...p}]));

                for (let i = 0; i < activeIds.length; i++) {
                    const pA = playersMap.get(activeIds[i]);
                    for (let j = i + 1; j < activeIds.length; j++) {
                        const pB = playersMap.get(activeIds[j]);
                        const expA = this.getExpectation(pA.elo, pB.elo);
                        const expB = this.getExpectation(pB.elo, pA.elo);

                        let scoreA = (this.data.winnerMode === 1) ? (i === 0 ? 1 : 0) : (i < j ? 1 : 0);
                        if (this.data.winnerMode === 1 && i !== 0) continue;

                        eloDeltas[activeIds[i]] += K_FACTOR * (scoreA - expA);
                        eloDeltas[activeIds[j]] += K_FACTOR * ((1-scoreA) - expB);
                    }
                }

                this.data.players = this.data.players.map(p => {
                    if (eloDeltas[p.id] !== undefined) {
                        return {
                            ...p,
                            elo: p.elo + eloDeltas[p.id],
                            matches: p.matches + 1,
                            wins: activeIds[0] === p.id ? p.wins + 1 : p.wins
                        };
                    }
                    return p;
                });

                const newHistoryEntry = {
                    date: new Date().toLocaleString('de-DE', { day:'2-digit', month:'2-digit', year:'numeric', hour: '2-digit', minute: '2-digit' }),
                    mode: this.data.winnerMode,
                    ranking: activeIds,
                    match_name: matchName 
                };

                const btn = document.getElementById('submit-btn');
                if(btn) btn.innerText = "Speichere...";
                
                try {
                    await this.saveData(newHistoryEntry);
                    await this.fetchData();
                    this.data.matchInputs = Array(8).fill('');
                    this.data.activeTab = 'rank';
                    this.render();
                } catch (e) {
                    alert("Fehler beim Speichern!");
                    if(btn) btn.innerText = "Berechnen & Speichern";
                }
            },

            getChartData() {
                const datasets = this.data.players.map((p, idx) => ({
                    label: p.name,
                    data: [1000],
                    borderColor: `hsl(${(idx * 360 / this.data.players.length)}, 70%, 50%)`,
                    backgroundColor: `hsl(${(idx * 360 / this.data.players.length)}, 70%, 50%)`,
                    borderWidth: 2,
                    tension: 0.2,
                    pointRadius: 2,
                    playerId: p.id
                }));

                const tempElo = {};
                this.data.players.forEach(p => tempElo[p.id] = 1000);

                this.data.history.forEach((m) => {
                    const activeIds = m.ranking;
                    const eloDeltas = {};
                    activeIds.forEach(id => eloDeltas[id] = 0);

                    for (let i = 0; i < activeIds.length; i++) {
                        const idA = activeIds[i];
                        for (let j = i + 1; j < activeIds.length; j++) {
                            const idB = activeIds[j];
                            const expA = this.getExpectation(tempElo[idA], tempElo[idB]);
                            const expB = this.getExpectation(tempElo[idB], tempElo[idA]);
                            let scoreA = (m.mode === 1) ? (i === 0 ? 1 : 0) : (i < j ? 1 : 0);
                            if (m.mode === 1 && i !== 0) continue;
                            eloDeltas[idA] += K_FACTOR * (scoreA - expA);
                            eloDeltas[idB] += K_FACTOR * ((1-scoreA) - expB);
                        }
                    }

                    Object.keys(eloDeltas).forEach(id => {
                        tempElo[id] += eloDeltas[id];
                    });

                    datasets.forEach(ds => {
                        ds.data.push(Math.round(tempElo[ds.playerId]));
                    });
                });

                return {
                    labels: ['Start', ...this.data.history.map((_, i) => `Sp ${i+1}`)],
                    datasets
                };
            },

            renderChart() {
                const ctx = document.getElementById('eloChart');
                if (!ctx) return;
                
                const data = this.getChartData();
                new Chart(ctx, {
                    type: 'line',
                    data: data,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: { intersect: false, mode: 'index' },
                        plugins: {
                            legend: { position: 'bottom', labels: { boxWidth: 10, font: { size: 10 }, usePointStyle: true } },
                            tooltip: { backgroundColor: 'rgba(0,0,0,0.8)', padding: 10 }
                        },
                        scales: {
                            y: { grid: { color: '#f1f5f9' }, ticks: { font: { size: 10 } } },
                            x: { grid: { display: false }, ticks: { font: { size: 10 } } }
                        }
                    }
                });
            },

            render() {
                const container = document.getElementById('app-content');
                const tabs = ['rank', 'history', 'match', 'settings'];
                
                tabs.forEach(t => {
                    const btn = document.getElementById(`btn-${t}`);
                    if(btn) btn.className = this.data.activeTab === t 
                        ? "flex-1 min-w-[80px] py-2 rounded text-xs sm:text-sm font-medium transition bg-emerald-100 text-emerald-800 shadow-sm"
                        : "flex-1 min-w-[80px] py-2 rounded text-xs sm:text-sm font-medium transition text-gray-500 hover:bg-gray-50";
                });

                if (this.data.activeTab === 'rank') {
                    this.renderRank(container);
                    setTimeout(() => this.renderChart(), 10);
                }
                else if (this.data.activeTab === 'history') this.renderHistory(container);
                else if (this.data.activeTab === 'match') this.renderMatch(container);
                else if (this.data.activeTab === 'settings') this.renderSettings(container);
            },

            renderRank(container) {
                const sorted = [...this.data.players].sort((a,b) => b.elo - a.elo);
                let html = `
                    <div class="bg-white rounded-lg shadow overflow-hidden mb-6">
                        <table class="w-full text-left border-collapse">
                            <thead class="bg-slate-50 text-slate-500 text-[10px] sm:text-xs uppercase font-bold">
                                <tr>
                                    <th class="p-3 w-12 text-center">#</th>
                                    <th class="p-3">Saufi</th>
                                    <th class="p-3 text-right">Elo</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-100">`;
                
                sorted.forEach((p, i) => {
                    const medal = i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : i === 2 ? 'ü•â' : '';
                    html += `<tr class="${i===0 ? 'bg-yellow-50' : 'hover:bg-slate-50 transition-colors'}">
                        <td class="p-3 text-slate-400 text-sm font-mono text-center">${i+1}</td>
                        <td class="p-3 font-medium flex items-center gap-2">
                            ${p.name} <span class="text-lg">${medal}</span>
                        </td>
                        <td class="p-3 text-right font-bold text-emerald-600 font-mono">${Math.round(p.elo)}</td>
                    </tr>`;
                });
                html += `</tbody></table></div>`;

                html += `
                    <div class="bg-white rounded-lg shadow mb-6 overflow-hidden">
                        <div class="p-4 border-b bg-slate-50">
                            <h3 class="text-xs font-bold text-slate-500 uppercase tracking-wider">Saufkurvn</h3>
                        </div>
                        <div class="p-2 h-72 sm:h-96">
                            <canvas id="eloChart"></canvas>
                        </div>
                    </div>`;

                html += `
                    <div class="mt-8 mb-4">
                        <div class="bg-white p-2 rounded-lg shadow-sm border border-slate-200 overflow-hidden">
                            <img src="${this.data.footerImageUrl}" 
                                 alt="Event Bild" 
                                 class="w-full h-auto rounded-md object-cover"
                                 onerror="this.parentElement.style.display='none'">
                            <div class="p-2 text-center">
                                <p class="text-[10px] text-slate-400 italic uppercase tracking-widest">H√ºter des Waundapokals</p>
                            </div>
                        </div>
                    </div>`;

                container.innerHTML = html;
            },

            renderHistory(container) {
                let html = `<h2 class="text-sm font-bold text-slate-500 uppercase mb-4 tracking-widest px-1">Spiel Historie</h2><div class="space-y-4 mb-8">`;
                
                if(this.data.history.length === 0) {
                    html += `<div class="bg-white p-10 rounded-lg shadow text-center text-slate-400 italic">Keine Matches gefunden. Zeit zum Saufi Saufi!</div>`;
                }
                
                [...this.data.history].reverse().forEach(m => {
                    const namesHtml = m.ranking.map((rid, idx) => {
                        const name = this.data.players.find(p => p.id === rid)?.name || '?';
                        const style = idx === 0 ? 'bg-yellow-100 text-yellow-800 border-yellow-200 font-bold scale-105' : 'bg-white border-slate-200 text-slate-600';
                        return `<span class="px-2 py-1 rounded text-[10px] border shadow-sm flex items-center gap-1 ${style}">
                            <span class="opacity-50">${idx+1}.</span> ${name}
                        </span>`;
                    }).join('');

                    html += `
                        <div class="bg-white p-4 rounded-lg shadow-sm border-l-4 border-emerald-500 hover:shadow-md transition-shadow">
                            <div class="flex justify-between items-start text-[10px] text-slate-400 mb-2 uppercase tracking-wide">
                                <div>
                                    ${m.match_name ? `<span class="font-bold text-emerald-700 block mb-1 text-sm">"${m.match_name}"</span>` : ''}
                                    <span class="bg-slate-100 px-2 py-0.5 rounded-full">Match #${m.match_id}</span> ‚Ä¢ <span>${m.date}</span>
                                </div>
                                <span class="bg-emerald-50 text-emerald-700 px-2 py-0.5 rounded font-bold">${m.mode === 1 ? 'Winner Only' : 'Ranked'}</span>
                            </div>
                            <div class="flex flex-wrap gap-1.5 mt-3">${namesHtml}</div>
                        </div>`;
                });
                
                container.innerHTML = html + `</div>`;
            },

            renderMatch(container) {
                const isRanked = this.data.winnerMode === 0;
                let html = `
                    <div class="bg-white rounded-lg shadow p-6">
                        <h2 class="font-bold text-lg mb-4 text-slate-700">Match eintragen</h2>
                        
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Modus w√§hlen</label>
                        <div class="flex gap-2 mb-6">
                            <button onclick="app.setWinnerMode(0)" class="flex-1 p-3 rounded-lg border text-xs transition-all ${isRanked ? 'bg-emerald-600 text-white shadow-lg border-emerald-600 font-bold' : 'bg-slate-50 text-slate-600 border-slate-200 hover:bg-slate-100'}">
                                PLATZIERUNG<br><span class="opacity-75 font-normal">Alle Pl√§tze z√§hlen</span>
                            </button>
                            <button onclick="app.setWinnerMode(1)" class="flex-1 p-3 rounded-lg border text-xs transition-all ${!isRanked ? 'bg-emerald-600 text-white shadow-lg border-emerald-600 font-bold' : 'bg-slate-50 text-slate-600 border-slate-200 hover:bg-slate-100'}">
                                WINNER ONLY<br><span class="opacity-75 font-normal">Nur der 1. gewinnt Elo</span>
                            </button>
                        </div>

                        <div class="mb-6">
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Match Bezeichnung</label>
                            <input type="text" id="input-match-name" class="w-full p-3 border rounded-lg text-sm outline-none focus:ring-2 focus:ring-emerald-500 bg-slate-50 border-slate-200" placeholder="z.B. Emma treiben">
                        </div>

                        <label class="block text-xs font-bold text-gray-500 uppercase mb-3">Ranking (1. bis 8. Platz)</label>
                        <div class="space-y-2.5 mb-8">`;
                
                const currentInputs = this.data.matchInputs;
                const duplicates = currentInputs.filter((id, index) => id !== "" && currentInputs.indexOf(id) !== index);

                for(let i=0; i<8; i++) {
                    const isDuplicate = currentInputs[i] !== "" && currentInputs.filter(id => id === currentInputs[i]).length > 1;
                    let options = `<option value="">-- Nicht teilgenommen --</option>`;
                    this.data.players.forEach(p => {
                        const selected = currentInputs[i] === p.id ? 'selected' : '';
                        options += `<option value="${p.id}" ${selected}>${p.name} (${Math.round(p.elo)})</option>`;
                    });
                    html += `
                        <div>
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0 ${i===0 ? 'bg-yellow-400 text-yellow-900 border-2 border-yellow-200' : 'bg-slate-100 text-slate-400'}">${i+1}</div>
                                <select onchange="app.updateMatchInput(${i}, this.value)" class="flex-1 p-2.5 border rounded-lg bg-white text-sm outline-none transition-colors ${isDuplicate ? 'border-red-500 bg-red-50 focus:border-red-600' : 'border-slate-200 focus:border-emerald-500'}">
                                    ${options}
                                </select>
                            </div>
                            ${isDuplicate ? `<p class="text-[10px] text-red-500 ml-11 mt-1 font-bold">‚ö†Ô∏è Spieler bereits ausgew√§hlt!</p>` : ''}
                        </div>`;
                }

                const hasDuplicates = duplicates.length > 0;
                container.innerHTML = html + `</div><button id="submit-btn" onclick="app.submitMatch()" ${hasDuplicates ? 'disabled' : ''} class="w-full ${hasDuplicates ? 'bg-slate-300 cursor-not-allowed' : 'bg-emerald-600 hover:bg-emerald-700 shadow-xl active:scale-[0.98]'} text-white font-bold py-4 rounded-xl transition-all">Match berechnen & speichern üçª</button></div>`;
            },

            renderSettings(container) {
                let html = `
                    <div class="bg-white rounded-lg shadow p-6">
                        <h2 class="font-bold text-lg mb-6 text-slate-700 border-b pb-2">Spieler-Management</h2>
                        
                        <div class="mb-8">
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-4">Namen anpassen</label>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">`;
                
                this.data.players.forEach((p, i) => {
                    html += `
                    <div class="flex items-center gap-3 p-2 bg-slate-50 rounded-lg border border-slate-100">
                        <span class="text-[10px] font-bold text-slate-300 w-5">${i+1}</span>
                        <input type="text" value="${p.name}" onchange="app.updatePlayerName('${p.id}', this.value)" class="flex-1 p-2 bg-transparent text-sm font-medium focus:text-emerald-700 outline-none">
                    </div>`;
                });
                
                html += `</div></div>
                        
                        <div class="border-t pt-10 mt-10 text-center">
                            <p class="text-xs text-slate-400 mb-4">Achtung: Dies l√∂scht alle bisherigen Elo-Daten und die Match-Historie!</p>
                            <button onclick="app.resetData()" class="bg-red-50 text-red-600 border border-red-100 px-6 py-2 rounded-full text-xs font-bold hover:bg-red-600 hover:text-white transition-all uppercase tracking-widest">
                                ‚ö†Ô∏è Datenbank zur√ºcksetzen
                            </button>
                        </div>
                    </div>`;
                container.innerHTML = html;
            },

            async resetData() {
                if(confirm("Wirklich ALLES l√∂schen? Der heilige Gral wird weinen.")) {
                    try {
                        await sbClient.from('players').delete().neq('id', 'deleted');
                        await sbClient.from('history').delete().neq('match_id', 0);
                        location.reload();
                    } catch (e) {
                        alert("Reset fehlgeschlagen: " + e.message);
                    }
                }
            },
            
            exportCSV() {
                let csv = "RANG,NAME,ELO,SPIELE,SIEGE\n";
                [...this.data.players].sort((a,b) => b.elo - a.elo).forEach((p, i) => {
                    csv += `${i+1},${p.name},${Math.round(p.elo)},${p.matches},${p.wins}\n`;
                });
                csv += "\nMATCH HISTORY\nID,DATUM,MATCH-NAME,MODUS,PLATZIERUNG...\n";
                this.data.history.forEach(m => {
                    const names = m.ranking.map(rid => this.data.players.find(p => p.id === rid)?.name).join(", ");
                    csv += `${m.match_id},${m.date},"${m.match_name || ''}",${m.mode === 1 ? 'WinnerOnly' : 'Ranked'},"${names}"\n`;
                });
                const link = document.createElement("a");
                link.href = "data:text/csv;charset=utf-8," + encodeURI(csv);
                link.download = "SaufiSaufi_Export.csv";
                link.click();
            },

            renderError(err) {
                document.getElementById('app-content').innerHTML = `
                    <div class="p-8 bg-red-50 text-red-700 rounded-xl text-center border border-red-100 shadow-sm">
                        <div class="text-4xl mb-4">üîå</div>
                        <h3 class="font-bold mb-2">Verbindungsfehler</h3>
                        <p class="text-sm opacity-75 mb-4">${err.message}</p>
                        <button onclick="location.reload()" class="bg-red-600 text-white px-6 py-2 rounded-full text-xs font-bold">Erneut versuchen</button>
                    </div>`;
            }
        };

        app.init();
    </script>
</body>
</html>


